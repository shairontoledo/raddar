<div class="navbar navbar-fixed-top">
  <div class="navbar-inner">
    <div class="container">
      <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </a>
      <%= link_to t('application.title'), root_path, :class => 'brand' %>
      <div class="nav-collapse">
        <ul class="nav">
          <li><%= link_to t('pub.p'), pubs_path %></li>
          <li><%= link_to t('forum.p'), forums_path %></li>
          <li><%= link_to t('venue.p'), venues_path %></li>
        </ul>
        <%= form_tag search_path, method: :get, :class => 'navbar-search' do %>
          <%= text_field_tag :q, params[:q], :class => 'search-query', placeholder: t('action.search')  %>
        <% end %>
        <ul class="nav pull-right">
          <% unless user_signed_in? %>
            <li><%= link_to t('action.sign_in'), new_user_session_path %></li>
          <% else %>
            
            <li class="dropdown" id="messages_notifications">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown" >
                <i class="icon-envelope"></i>
                <span class="badge badge-important notification_count"></span>
              </a>
              <ul class="dropdown-menu">
                <% if current_user.count_unread_chats > 0 %>
                  <% current_user.unread_chats.each do |chat| %>
                    <%= render 'messages/notification', {message: chat.last} %>
                  <% end %>
                <% end %>
                <li class="divider"></li>
                <li><%= link_to t('message.all'), all_messages_path %></li>
              </ul>
            </li>

            <li class="divider-vertical"></li>

            <li class="dropdown" id="general_notifications">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                <i class="icon-flag"></i>
                <span class="badge badge-important notification_count"></span>
              </a>
              <ul class="dropdown-menu">
                <% current_user.unread_notifications.each do |notification| %>
                  <%= render 'notifications/notification', {notification: notification} %>
                <% end %>
                <li class="divider"></li>
                <li><%= link_to t('notification.see_all'), notifications_path %></li>
              </ul>
            </li>

            <li class="divider-vertical"></li>

            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                <%= image_tag current_user.avatar.thumb.url, :class => 'size20' %>
                <%= current_user.name %>
                <span id="notifications_count"></span>
              </a>
              <ul class="dropdown-menu">
                <li>
                  <%= link_to current_user do %>
                    <i class="icon-user"></i>
                    <%= t('user.account.my') %>
                  <% end %>
                </li>
                <li>
                  <%= link_to edit_user_registration_path do %>
                    <i class="icon-edit"></i>
                    <%= t('user.account.settings') %>
                  <% end %>
                </li>
                <% if can? :manage, :all %>
                  <li class="divider"></li>
                  <li>
                    <%= link_to admin_root_path do %>
                      <i class="icon-wrench"></i>
                      <%= t('action.admin') %>
                    <% end %>
                  </li>
                <% end %>
                <li class="divider"></li>
                <li>
                  <%= link_to destroy_user_session_path, :method=>'delete' do %>
                    <i class="icon-off"></i>
                    <%= t('action.sign_out') %>
                  <% end %>
                </li>
              </ul>
            </li>
          <% end %>
        </ul>
      </div>
    </div>
  </div>
</div>